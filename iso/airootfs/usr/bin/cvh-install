#!/bin/bash
# CVH Linux Installer
# Modular installer for CVH Linux distribution
# Run from live environment to install CVH Linux to disk

set -o pipefail

# Installer library path
INSTALLER_LIB="/usr/lib/cvh-install"

# Source all modules
source "${INSTALLER_LIB}/ui.sh"
source "${INSTALLER_LIB}/config.sh"
source "${INSTALLER_LIB}/detect.sh"
source "${INSTALLER_LIB}/input.sh"
source "${INSTALLER_LIB}/disk.sh"
source "${INSTALLER_LIB}/packages.sh"
source "${INSTALLER_LIB}/configure.sh"
source "${INSTALLER_LIB}/finalize.sh"

# Main installation flow
main() {
    # Pre-flight checks
    check_root

    # Welcome screen
    show_welcome

    # System detection
    detect_boot_mode

    # User input phase
    select_keyboard
    select_timezone
    select_compositor
    select_disk
    set_hostname
    create_user_config

    # Disk preparation
    partition_disk

    # System installation
    install_base
    generate_fstab

    # System configuration
    configure_system

    # Final setup
    set_passwords
    finish_installation
}

# Run main
main "$@"
